# [Cron —É—Å—Ç–∞—Ä–µ–ª? systemd‚Äë—Ç–∞–π–º–µ—Ä—ã –∫–∞–∫ –≤–∑—Ä–æ—Å–ª—ã–π —Å–ø–æ—Å–æ–± ¬´–∑–∞–ø—É—Å–∫–∞—Ç—å –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é¬ª](https://t.me/c/2229907452/772)

–ö–ª–∞—Å—Å–∏–∫–∞:
crontab -e, –∑–≤—ë–∑–¥–æ—á–∫–∏ * * * * *, —Å–∫—Ä–∏–ø—Ç –≤ /usr/local/bin, –∏ *–∞–≤–æ—Å—å –æ–Ω–æ –±—É–¥–µ—Ç —Å–∞–º–æ –∫—Ä—É—Ç–∏—Ç—å—Å—è*. –ü–æ–∫–∞ –æ–¥–Ω–∞–∂–¥—ã –Ω–µ –≤—ã—è—Å–Ω—è–µ—Ç—Å—è, —á—Ç–æ:

üü¢ –¥–∂–æ–±–∞ —É–ø–∞–ª–∞, –∞ —Ç—ã –¥–∞–∂–µ –Ω–µ –∑–∞–º–µ—Ç–∏–ª;
üü¢ —Å—Ç–∞—Ä–∞—è –µ—â—ë —Ä–∞–±–æ—Ç–∞–µ—Ç, –∞ –Ω–æ–≤–∞—è —É–∂–µ —Å—Ç–∞—Ä—Ç–∞–Ω—É–ª–∞;
üü¢ —Å–µ—Ä–≤–µ—Ä –±—ã–ª –≤—ã–∫–ª—é—á–µ–Ω –≤ –º–æ–º–µ–Ω—Ç –∑–∞–ø—É—Å–∫–∞ ‚Äî –∑–∞–¥–∞—á–∞ –ø—Ä–æ—Å—Ç–æ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∞—Å—å.

–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Linux —É–∂–µ –∂–∏–≤—ë—Ç –Ω–∞ systemd, –∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ª–æ–≥–∏—á–Ω–µ–µ —Å—Ç—Ä–æ–∏—Ç—å —á–µ—Ä–µ–∑ systemd timers, –∞ –Ω–µ —á–µ—Ä–µ–∑ –¥—Ä–µ–≤–Ω–∏–π cron.

–í —á—ë–º –≥–ª–∞–≤–Ω–∞—è —Ä–∞–∑–Ω–∏—Ü–∞
üü¢ cron –∑–Ω–∞–µ—Ç —Ç–æ–ª—å–∫–æ: –∫–æ–≥–¥–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏ –∫–∞–∫—É—é –∫–æ–º–∞–Ω–¥—É.
–õ–æ–≥–∏, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è ‚Äî –≤—Å—ë —Ä—É—á–∫–∞–º–∏.
üü¢ systemd‚Äë—Ç–∞–π–º–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç service‚Äë—é–Ω–∏—Ç, –∞ –≤–æ–∫—Ä—É–≥ –Ω–µ–≥–æ —É–∂–µ –µ—Å—Ç—å:
üü¢ –ª–æ–≥–∏ journalctl,
üü¢ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –ø–∞–º—è—Ç–∏/CPU,
üü¢ –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤,
üü¢ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–µ—Ç–∏, –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ —Å–∏—Å—Ç–µ–º—ã –∏ —Ç.–¥..
–ü–æ —Å—É—Ç–∏, —Ç–∞–π–º–µ—Ä ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Ç—Ä–∏–≥–≥–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –¥—ë—Ä–≥–∞–µ—Ç —Å–µ—Ä–≤–∏—Å.


–ü—Ä–æ—Å—Ç–∞—è –∑–∞–º–µ–Ω–∞ cron‚Äë–∑–∞–¥–∞—á–∏

–î–æ–ø—É—Å—Ç–∏–º, —Ä–∞–Ω—å—à–µ –≤ crontab –±—ã–ª–æ —Ç–∞–∫:
0 3 * * * /usr/local/bin/backup.sh

–¢–æ –∂–µ —Å–∞–º–æ–µ –Ω–∞ systemd ‚Äî —ç—Ç–æ –¥–≤–∞ —Ñ–∞–π–ª–∞:

/etc/systemd/system/backup.service:
[Unit]
Description=Nightly backup

[Service]
Type=oneshot
ExecStart=/usr/local/bin/backup.sh

/etc/systemd/system/backup.timer:
[Unit]
Description=Run backup every night at 03:00

[Timer]
OnCalendar=03:00
Persistent=true

[Install]
WantedBy=timers.target

–î–∞–ª—å—à–µ:
sudo systemctl daemon-reload
sudo systemctl enable --now backup.timer

üü¢ OnCalendar=03:00 ‚Äî –∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00.
üü¢ Persistent=true ‚Äî –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –±—ã–ª –≤—ã–∫–ª—é—á–µ–Ω –≤ 3:00, –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤–∫–ª—é—á–µ–Ω–∏–∏.

–ü–æ—á–µ–º—É —Ç–∞–π–º–µ—Ä—ã —É–¥–æ–±–Ω–µ–µ cron‚Äô–∞

1. –ù–µ—Ç –≥–æ–Ω–æ–∫ –∏ –¥—É–±–ª–µ–π –∑–∞–ø—É—Å–∫–æ–≤
   –ï—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∑–∞–ø—É—Å–∫ –µ—â—ë –∏–¥—ë—Ç, cron —Ç—É–ø–æ –∑–∞–ø—É—Å—Ç–∏—Ç –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä. –ú–æ–∂–Ω–æ –Ω–∞—Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–æ—Ç–Ω–∏ –∑–∞–≤–∏—Å—à–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.
   Systemd –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –¥–∞—ë—Ç —Å–µ—Ä–≤–∏—Å—É —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å –≤—Ç–æ—Ä–∏—á–Ω–æ, –ø–æ–∫–∞ –ø–µ—Ä–≤—ã–π –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è (–∑–∞–¥–∞—ë—Ç—Å—è RestartPreventExitStatus, RefuseManualStart –∏ —Ç.–ø.).

2. –ù–æ—Ä–º–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –∏–∑ –∫–æ—Ä–æ–±–∫–∏
   –í–º–µ—Å—Ç–æ –∑–∞–≥–∞–¥–æ—á–Ω—ã—Ö –ø–∏—Å–µ–º –æ—Ç cron:
   journalctl -u backup.service
   –°–º–æ—Ç—Ä–∏—à—å, –∫–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–ª–æ—Å—å, —Å –∫–∞–∫–∏–º –∫–æ–¥–æ–º –∑–∞–≤–µ—Ä—à–∏–ª–æ—Å—å, –∫–∞–∫–æ–π –±—ã–ª –≤—ã–≤–æ–¥.

3. –£—Å–ª–æ–≤–∏—è –∑–∞–ø—É—Å–∫–∞
   –¢–∞–π–º–µ—Ä –º–æ–∂–Ω–æ –ø—Ä–∏–≤—è–∑–∞—Ç—å –∫ —Å–æ–±—ã—Ç–∏—è–º:
- OnBootSec=10min ‚Äî —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏.
- OnUnitActiveSec=1h ‚Äî –∫–∞–∂–¥—ã–µ 60 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞.
- RandomizedDelaySec=30min ‚Äî —Ä–∞–∑–º–∞–∂—å –∑–∞–ø—É—Å–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–∏, —á—Ç–æ–±—ã –Ω–µ —É—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–∏–∫ –Ω–∞–≥—Ä—É–∑–∫–∏ —Ä–æ–≤–Ω–æ –≤ 03:00.

4. –õ–µ–≥–∫–æ –≤–∫–ª—é—á–∞—Ç—å/–≤—ã–∫–ª—é—á–∞—Ç—å
   –í–º–µ—Å—Ç–æ –ø—Ä–∞–≤–∫–∏ crontab:
   sudo systemctl disable backup.timer
   sudo systemctl enable backup.timer
   –ò –≤–∏–¥–Ω–æ —Å—Ç–∞—Ç—É—Å:
   systemctl list-timers
   –ü–æ–∫–∞–∂–µ—Ç, —á—Ç–æ —É–∂–µ –æ—Ç—Ä–∞–±–æ—Ç–∞–ª–æ –∏ –∫–æ–≥–¥–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è —Å–Ω–æ–≤–∞.

–ö–æ–≥–¥–∞ cron –≤—Å—ë –µ—â—ë –æ–∫
üü¢ –ü—Ä–æ—Å—Ç–µ–π—à–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∑–∞–¥–∞—á–∫–∏ —É—Ä–æ–≤–Ω—è:
üü¢ "—Ä–∞–∑ –≤ —á–∞—Å —á–∏—Å—Ç–∏—Ç—å –∫—ç—à –≤ $HOME/tmp","—Ä–∞–∑ –≤ –¥–µ–Ω—å —Å–∏–Ω–∫–∞—Ç—å –∑–∞–º–µ—Ç–∫–∏".
üü¢ –°—Ç–∞—Ä—ã–µ —Å–∏—Å—Ç–µ–º—ã –±–µ–∑ systemd (—Å—Ç–∞—Ä—ã–µ UNIX, –∫–∞–∫–∏–µ‚Äë—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã).

Linux administration (https://t.me/c/2229907452/213) || #Cron
